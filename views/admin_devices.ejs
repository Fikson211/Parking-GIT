<%- include('partials/header', { title: 'Устройства', user }) %>

<div class="card">
  <div class="topbar">
    <div class="pill">Админ-панель</div>
    <div class="nav">
      <a href="/" class="pill">Дашборд</a>
      <a href="/logs" class="pill">Журнал</a>
      <a href="/admin/users" class="pill">Пользователи</a>
      <a href="/admin/zones" class="pill">Зоны</a>
      <a href="/admin/devices" class="pill" style="background:rgba(255,255,255,.12)">Устройства</a>
      <a href="/admin/audit" class="pill">Аудит</a>
      <a href="/logout" class="pill">Выйти</a>
    </div>
  </div>

  <h2 style="margin-top:0">Устройства</h2>

  <form method="post" action="/admin/devices" style="display:grid;grid-template-columns: 220px 260px 1fr 120px 90px 90px;gap:10px;align-items:end">
    <div>
      <div class="muted">ID (уникальный)</div>
      <input name="id" placeholder="gate_1" required />
    </div>
    <div>
      <div class="muted">Имя</div>
      <input name="name" placeholder="Ворота 1" required />
    </div>
    <div>
      <div class="muted">URL</div>
      <input name="url" placeholder="http://..." required />
    </div>
    <div>
      <div class="muted">Метод</div>
      <select name="method">
        <option value="GET">GET</option>
        <option value="POST">POST</option>
      </select>
    </div>
    <div>
      <div class="muted">Зона</div>
      <select name="zone_id">
        <% zones.forEach(z => { %>
          <option value="<%= z.id %>"><%= z.name %></option>
        <% }) %>
      </select>
    </div>
    <div>
      <div class="muted">Сорт.</div>
      <input name="sort" type="number" value="0" />
    </div>
    <div>
      <div class="muted">Активно</div>
      <select name="is_active">
        <option value="true">Да</option>
        <option value="false">Нет</option>
      </select>
    </div>
    <div>
      <button type="submit">Добавить</button>
    </div>
  </form>

  <div style="margin-top:18px;overflow:auto">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Имя</th>
          <th>Зона</th>
          <th>Метод</th>
          <th>URL</th>
          <th>Сорт.</th>
          <th>Активно</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% devices.forEach(d => { %>
          <tr>
            <td><%= d.id %></td>
            <td><%= d.name %></td>
            <td><%= d.zone_name || d.zone_id %></td>
            <td><%= d.method %></td>
            <td style="max-width:460px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"><%= d.url %></td>
            <td><%= d.sort || 0 %></td>
            <td><%= d.is_active ? 'Да' : 'Нет' %></td>
            <td style="white-space:nowrap">
              <form method="post" action="/admin/devices/<%= d.id %>/delete" style="display:inline" onsubmit="return confirm('Удалить устройство?')">
                <button class="danger" type="submit">Удалить</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>

<%- include('partials/footer') %>
