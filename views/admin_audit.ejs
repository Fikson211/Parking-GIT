<%- include('partials/header', { title: 'Админ • Журнал действий', user, bodyClass }) %>

<div class="page-head">
  <div>
    <div class="text-muted small">Админ-панель</div>
    <h1 class="h4 mb-0">Журнал действий</h1>
  </div>
  <div class="d-flex gap-2 flex-wrap">
    <a class="btn btn-sm btn-outline-secondary" href="/admin/users">Пользователи</a>
    <a class="btn btn-sm btn-outline-secondary" href="/admin/devices">Устройства</a>
  </div>
</div>

<div class="audit-mobile-list d-block d-md-none">
  <% entries.forEach(e => { %>
    <div class="lux-card mb-2">
      <div class="lux-card-head">
        <div class="lux-badge"><%= e.action %></div>
        <div class="lux-muted"><%= (e.ts ? new Date(e.ts).toLocaleString('ru-RU') : '-') %></div>
      </div>
      <div class="lux-card-body">
        <div class="lux-row"><span class="lux-label">Кто</span><span class="lux-value"><%= e.actorFio || '—' %></span></div>
        <div class="lux-row"><span class="lux-label">Телефон</span><span class="lux-value lux-muted"><%= e.actorPhone || e.actorId || '—' %></span></div>
        <div class="lux-row"><span class="lux-label">Объект</span><span class="lux-value"><span class="lux-muted"><%= e.targetType %>:</span> <code class="mono"><%= e.targetId %></code></span></div>
        <% if (e.ip) { %><div class="lux-row"><span class="lux-label">IP</span><span class="lux-value mono"><%= e.ip %></span></div><% } %>
        <% if (e.details) { %>
          <div class="lux-details"><pre class="lux-pre"><%= JSON.stringify(e.details, null, 2) %></pre></div>
        <% } %>
      </div>
    </div>
  <% }) %>
  <% if (!entries.length) { %>
    <div class="lux-card"><div class="lux-card-body lux-muted">Пока пусто.</div></div>
  <% } %>
</div>

<div class="card shadow-sm d-none d-md-block">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0 table-lux">
      <thead class="table-light">
        <tr>
          <th style="min-width:170px">Дата</th>
          <th style="min-width:180px">Кто</th>
          <th style="min-width:160px">Действие</th>
          <th style="min-width:220px">Объект</th>
          <th>Детали</th>
        </tr>
      </thead>
      <tbody>
        <% entries.forEach(e => { %>
          <tr>
            <td class="small lux-muted">
              <%= (e.ts ? new Date(e.ts).toLocaleString('ru-RU') : '-') %>
            </td>
            <td>
              <div class="fw-semibold"><%= e.actorFio || '—' %></div>
              <div class="lux-muted small"><%= e.actorPhone || e.actorId || '' %></div>
            </td>
            <td><span class="badge badge-lux"><%= e.action %></span></td>
            <td class="small">
              <div><span class="lux-muted"><%= e.targetType %>:</span> <code class="mono"><%= e.targetId %></code></div>
              <% if (e.ip) { %><div class="lux-muted"><%= e.ip %></div><% } %>
            </td>
            <td class="small lux-muted">
              <pre class="lux-pre"><%= e.details ? JSON.stringify(e.details, null, 2) : '' %></pre>
            </td>
          </tr>
        <% }) %>
        <% if (!entries.length) { %>
          <tr><td colspan="5" class="lux-muted p-4">Пока пусто.</td></tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>
<%- include('partials/footer') %>
