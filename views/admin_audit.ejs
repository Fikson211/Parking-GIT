<%- include('partials/header', { title: 'Админ • Журнал действий', user, bodyClass }) %>

<div class="page-head">
  <div>
    <div class="text-muted small">Админ-панель</div>
    <h1 class="h4 mb-0">Журнал действий</h1>
  </div>
  <div class="d-flex gap-2 flex-wrap">
    <a class="btn btn-sm btn-outline-secondary" href="/admin/users">Пользователи</a>
    <a class="btn btn-sm btn-outline-secondary" href="/admin/devices">Устройства</a>
  </div>
</div>

<div class="card shadow-sm">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th style="min-width:170px">Дата</th>
          <th style="min-width:180px">Кто</th>
          <th style="min-width:160px">Действие</th>
          <th style="min-width:220px">Объект</th>
          <th>Детали</th>
        </tr>
      </thead>
      <tbody>
        <% entries.forEach(e => { %>
          <tr>
            <td class="small text-muted">
              <% const ts = e.ts ? (typeof e.ts === 'string' ? e.ts : e.ts.toISOString()) : ''; %>
              <%= ts.replace('T',' ').replace('Z','') %>
            </td>
            <td>
              <div class="fw-semibold"><%= e.actorFio || '—' %></div>
              <div class="text-muted small"><%= e.actorPhone || e.actorId || '' %></div>
            </td>
            <td><span class="badge text-bg-light border"><%= e.action %></span></td>
            <td class="small">
              <div><span class="text-muted"><%= e.targetType %>:</span> <code><%= e.targetId %></code></div>
              <% if (e.ip) { %><div class="text-muted"><%= e.ip %></div><% } %>
            </td>
            <td class="small text-muted">
              <pre class="audit-pre"><%= e.details ? JSON.stringify(e.details, null, 2) : '' %></pre>
            </td>
          </tr>
        <% }) %>
        <% if (!entries.length) { %>
          <tr><td colspan="5" class="text-muted p-4">Пока пусто.</td></tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>

<%- include('partials/footer') %>
